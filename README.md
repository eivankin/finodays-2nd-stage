# Определение эмоционального окраса текста
## Установка и запуск
Предварительные требования: наличие установленного Python 3. 
Работоспособность решения проверена на ОС Linux (Debian).
Для установки зависимостей выполните команду:
```shell
pip3 install -r requirements.txt
```
Для запуска тестового сервера по адресу 127.0.0.1:5000 выполните команду:
```shell
python3 main.py
```
Сервер поддерживает два варианта обращения: JSON API и форма. 
Чтобы обратиться к серверу через API выполните команду:
```shell
curl -X POST -H "Content-Type: application/json" \
  --data '{"text": "Введите тут текст для анализа"}' \
  http://127.0.0.1:5000/api/analyze
```
Форма для ввода текста доступна на странице http://127.0.0.1:5000/ 
Пример взаимодействия с формой можно видеть на скриншоте ниже:
![Форма](https://imgur.com/cMVICtB.png)

## Обзор репозитория
- Директория _data_: данные для обучения модели, использован обработанный [датасет отзывов IMDB](https://github.com/rasbt/python-machine-learning-book/tree/master/code/datasets/movie) (английский язык) и [датасет отзывов с сайта Кинопоиск](https://www.kaggle.com/mikhailklemin/kinopoisks-movies-reviews) (русский язык).
- Директория _templates_: html-шаблоны веб-сервера.
- Директория _trained-ru-20k-70p_: модель, обученная на 20 тысячах отзывов с сайта Кинопоиск.
- Файлы формата _*.cfg_: конфигурации для обучения моделей.
- Скрипт _preprocess.py_: служит для преобразования датасета IMDB в файлы формата *.spacy и разделение на обучающую и тестовую выборки.
- Скрипт _kinopoisk_preprocess.py_: служит для преобразования датасета отзывов с Кинопоиска в файлы формата *.spacy и разделение на обучающую, тестовую и валидационную выборки.
- Скрипт _get_user_messages.py_: служит для извлечения сообщений и оценок пользователей из Excel-таблицы.

## Обучение модели на примере датасета Кинопоиска
1. Скачать датасет с Kaggle, распаковать в директорию _data_.
2. Выполнить команду ``python3 kinopoisk_preprocess.py`` с желаемыми параметрами (см. ``python3 kinopoisk_preprocess.py --help``). 
__Примечание__: нужно с осторожностью увеличивать размеры выборок, так как для обучения может потребоваться очень много оперативной памяти.
3. Выполните команду ``spacy init fill-config ru_base_config.cfg config.cfg`` для создания полной конфигурации из базовой.
4. Опционально: выполните команду ``spacy debug data config.cfg -V``, чтобы убедиться в корректности конфигурации и сформированных для обучения файлах *.spacy.
5. Выполните команду ``spacy train config.cfg`` для обучения модели по созданной конфигурации.
6. Выполните команду ``spacy evaluate model-best/ data/ru_validation/validate.spacy`` для проверки точности модели на валидационной выборке.